Categoria,Código da Regra,Nome da Regra,Descrição Objetiva,Tabelas Envolvidas,Campos Envolvidos,Quando Aplicar,O que é Obrigatório,O que é Proibido,Impacto em Caso de Violação,Exemplo Prático,Status
Financeiro - Exclusão,FIN-EXC-001,Definição Oficial de Exclusão,Um título financeiro só é considerado excluído quando o campo TIPO da tabela de origem for igual a 'E'.,"EXC_PAGAR, EXC_RECEBER",TIPO,Consultas sobre exclusão de contas a pagar ou receber,Filtrar obrigatoriamente por TIPO = 'E',"Inferir exclusão por ausência de dados, log ou status calculado",Bloqueio total da consulta,Resultados incorretos ou vazios,Ativa
Financeiro - Exclusão,FIN-EXC-002,Fonte da Verdade da Exclusão,A existência da exclusão é determinada exclusivamente pela tabela do título financeiro.,"EXC_PAGAR, EXC_RECEBER","CONTROLE, TIPO",Sempre que a pergunta envolver exclusão,Usar tabela do título como base da consulta,Usar EXC_USUARIO como fonte primária,Erro lógico silencioso,Consulta retorna vazio indevidamente,Ativa
Financeiro - Exclusão,FIN-EXC-003,Uso Correto da Tabela de Log,A tabela EXC_USUARIO serve apenas para identificar usuário e data do log.,EXC_USUARIO,"USUARIO, DATA, CTRMOVI, MOVI",Quando for necessário identificar quem excluiu,Utilizar apenas LEFT JOIN,Filtrar resultados usando campos do log,Perda de registros válidos,Exclusões não aparecem no resultado,Ativa
Financeiro - Exclusão,FIN-EXC-004,Regra Temporal Oficial,Períodos devem ser filtrados pela data de emissão do título financeiro.,"EXC_PAGAR, EXC_RECEBER",EMISSAO,Perguntas com referência temporal,Aplicar filtros de data sobre EMISSAO,Usar DATA do log como referência temporal,Consulta imprecisa,Período financeiro incorreto,Ativa
Financeiro - Exclusão,FIN-EXC-005,Hierarquia de Datas,"Existe uma hierarquia fixa entre dadas financeiras, contratuais e administrativas.","EXC_PAGAR, EXC_RECEBER, EXC_USUARIO","EMISSAO, VENCTO, DATA",Sempre que múltiplas dadas existirem,Respeitar a hierarquia EMISSAO > VENCTO > DATA,Inverter a prioridade das datas,Erro semântico,Resultados inconsistentes,Ativa
Financeiro - Exclusão,FIN-EXC-006,Identificação do Usuário da Exclusão,"O usuário da exclusão é obtido via log, sem impactar a existência do título.",EXC_USUARIO,"USUARIO, CTRMOVI, MOVI",Quando solicitado o responsável pela exclusão,Relacionar via CTRMOVI e MOVI corretos,Exigir log como condição da exclusão,Perda de dados válidos,Exclusões sem log não aparecem,Ativa
Financeiro - Exclusão,FIN-EXC-007,Estrutura SQL Obrigatória,Consultas de exclusão devem seguir estrutura padronizada.,"EXC_PAGAR, EXC_RECEBER, EXC_USUARIO","TIPO, EMISSAO, CONTROLE",Geração automática de SQL,From na tabela do título + LEFT JOIN no log,Inner Join com tabela de log,Resultado vazio indevido,Falsa ausência de dados,Ativa
Financeiro - Exclusão,FIN-EXC-008,Validação Semântica Pré-Geração,O agente deve validar regras críticas antes de gerar SQL.,Todas,,Antes da execução da query,"Validar tipo, datas e joins",Gerar SQL sem validação prévia,Erro recorrente,Repetição do mesmo erro,Ativa
Financeiro - Exclusão,FIN-EXC-009,Regra Anti-Regressão,Mudanças nas regras de exclusão exigem revisão estrutural.,Todas,,Manutenção e evolução do agente,Manter regras estáveis,Alterar lógica sem versionamento,Regressão funcional,Falhas recorrentes em produção,Ativa
Exclusões Financeiras,R-EXC_001,"Exclusão é evento, não atributo","Exclusões de contas a pagar, receber, vendas ou pagamentos NÃO devem ser inferidas por campos das tabelas de negócio. Toda exclusão é registrada exclusivamente na tabela EXC_USUARIO.","EXC_USUARIO, EXC_PAGAR, EXC_RECEBER, EXC_VENDAS, EXC_MOVIFP",EXC_USUARIO.CTRMOVI,"Sempre que a pergunta envolver exclusão, apagado ou removido",Iniciar queries pela tabela EXC_USUARIO; Join via CTRMOVI = CONTROLE; Filtrar por EXC_USUARIO.DATA,"TIPO, STATUS, FLAG nas tabelas de negócio para exclusão",SQLCODE -206 (Column unknown) ou resultados incorretos,SELECT * FROM EXC_USUARIO INNER JOIN EXC_RECEBER ON EXC_USUARIO.CTRMOVI = EXC_RECEBER.CONTROLE WHERE EXC_USUARIO.MOVI = 'RC',OBRIGATÓRIA
Exclusões Financeiras,R-EXC_010,Exclusão híbrida (Estado + Evento),"Em contas a pagar/receber, a exclusão é identificada pelo campo TIPO = 'E' na tabela de negócio. A tabela EXC_USUARIO é complementar e NÃO obrigatória.","EXC_PAGAR, EXC_RECEBER, EXC_USUARIO","TIPO, CONTROLE",Sempre que a pergunta envolver exclusão,Filtrar TIPO = 'E' na tabela do título; Usar LEFT JOIN para EXC_USUARIO,Usar INNER JOIN com EXC_USUARIO; Usar EXC_USUARIO como âncora,Falso negativo (perda de registros sem log),SELECT * FROM EXC_PAGAR EP LEFT JOIN EXC_USUARIO EU ON ... WHERE EP.TIPO = 'E',CRÍTICA
Exclusões Financeiras,R-EXC-REAL-001,Exclusão definida por TIPO,Exclusão de contas a pagar é definida EXCLUSIVAMENTE por EP.TIPO = 'E'. Origem: SQL Validado.,EXC_PAGAR,TIPO,Sempre que a pergunta envolver exclusão,Filtrar TIPO = 'E' na tabela EXC_PAGAR,Inferir exclusão via EXC_USUARIO; Usar EXC_USUARIO como FROM,BLOQUEIO IMEDIATO - Falso negativo,WHERE EP.TIPO = 'E',BLOQUEANTE
Exclusões Financeiras,R-EXC-REAL-002,EXC_USUARIO sempre LEFT JOIN,EXC_USUARIO é sempre LEFT JOIN porque usuário pode não existir. Origem: SQL Validado.,EXC_USUARIO,"CTRMOVI, MOVI",Quando incluir dados de auditoria,Usar LEFT JOIN; Ligar via CTRMOVI = CONTROLE,Usar INNER JOIN; Usar como tabela base,Perda de registros sem log,LEFT JOIN exc_usuario eu ON eu.ctrmovi = ep.controle AND eu.movi = 'PG',ALTA
Exclusões Financeiras,R-EXC-REAL-003,"MOVI filtra tipo, não título","MOVI filtra o tipo de exclusão (PG/RC), nunca o título. Origem: SQL Validado.",EXC_USUARIO,MOVI,Ao fazer join com EXC_USUARIO,Incluir MOVI = 'PG' ou 'RC' no JOIN,Filtrar título por MOVI,Dados incorretos,AND eu.movi = 'PG',ALTA
Filtros Temporais,R-DATE-REAL-001,Filtro temporal usa EMISSAO,"Filtro temporal deve usar EP.EMISSAO, nunca EU.DATA. Origem: SQL Validado.",EXC_PAGAR,EMISSAO,Quando filtrar por período,Filtrar por EP.EMISSAO,Filtrar por EU.DATA,BLOQUEIO IMEDIATO - Dados incorretos,WHERE EP.EMISSAO >= DATEADD(-15 DAY TO CURRENT_DATE),BLOQUEANTE
